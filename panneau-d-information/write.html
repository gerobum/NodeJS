<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Bonjour Maman</title>
        <style>
            #zone_msg {
                color: white;
                background-color: #5890AD;
                padding: 2px;
            }
            #zone_msg {
                color: white;
                background-color: #ffc520;
                padding: 2px;
            }
            .cliquable {
                cursor: pointer;
                color: #b81900
            }
            .titre {
                background-color: #008; 
                color: antiquewhite; 
                padding: 0 0 0 5px; 
                margin: 0 0 0 0;
                line-height:1em;
                border-style: hidden;
                font-family: "Bradley Hand", cursive, fantasy, Georgia, "DejaVu Serif", Norasi, serif;
            }
            .liste {
                padding: 5px; 
                margin: 0 0 0 0;
                line-height:1em;
                border-style: hidden;
                font-family: Georgia, "DejaVu Serif", Norasi, serif;
            }
            .pair {
                background-color: #BAFFA8;
                color: #000;
            }
            .impair {
                background-color: #FFFFD0;
                color: #000;
            }
            .hsep {
                border-style: inset;
                padding: 0.5%;
            }
        </style>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <link rel="stylesheet" href="/resources/demos/style.css">
        <link rel="stylesheet" href="include/ui-1.10.0/ui-lightness/jquery-ui-1.10.0.custom.min.css" type="text/css" />
        <link rel="stylesheet" href="jquery.ui.timepicker.css?v=0.3.3" type="text/css" />

    </head>

    <body>
        <h1 class="titre">Bonjour Maman</h1>        
        <h2 class="titre">Nous sommes le <span id="div_date"></span></h2>
        <h2 class="titre" style="padding-bottom: 5px;">Il est <span id="div_horloge"></span></h2>

        <div class="titre" id="zone_msg">
        </div>

        <!--<form action="/todo/ajouter/" method="post" id="formulaire_ajout">-->
        <!--onclick="toggle('iddate', 'date')-->
        <p>
            <span class="hsep">Date: <input id="iddate" class="date" type="checkbox" /> <input disabled id="datepicker" type="text" class="date" autofocus/></span>
            <span class="hsep">Ordre : <input id="iddebut" type="checkbox" class="debut"/>
                <select disabled class="debut" id="hdebut" name="nom">
                    <option>00
                    <option>01
                    <option>02
                    <option>03
                    <option>04
                    <option>05
                    <option>06
                    <option>07
                    <option>08
                    <option>09
                    <option>10
                    <option>11 
                    <option>12
                    <option>13
                    <option>14
                    <option>15
                    <option>16
                    <option>17
                    <option>18
                    <option>19
                    <option>20
                    <option>21 
                    <option>22
                    <option>23              
                </select>: 
                <select disabled class="debut" id="mdebut" name="nom" size="1">
                    <option>00
                    <option>05
                    <option>10
                    <option>15
                    <option>20
                    <option>25   
                    <option>30
                    <option>35
                    <option>40
                    <option>45
                    <option>50
                    <option>55             
                </select>
            </span>

            <span class="hsep">Expiration : <input id="idfin" type="checkbox" class ="fin"/>
                <select disabled id="hfin" class="fin" size="1">
                    <option>00
                    <option>01
                    <option>02
                    <option>03
                    <option>04
                    <option>05
                    <option>06
                    <option>07
                    <option>08
                    <option>09
                    <option>10
                    <option>11 
                    <option>12
                    <option>13
                    <option>14
                    <option>15
                    <option>16
                    <option>17
                    <option>18
                    <option>19
                    <option>20
                    <option>21 
                    <option>22
                    <option>23              
                </select>: 
                <select disabled id="mfin" class="fin">
                    <option>00
                    <option>05
                    <option>10
                    <option>15
                    <option>20
                    <option>25   
                    <option>30
                    <option>35
                    <option>40
                    <option>45
                    <option>50
                    <option>55             
                </select>   
            </span>
        </p>
        <textarea cols="80" rows="10" placeholder="Un message" name="newtodo" id="newtodo" ></textarea>
        <button id="sendbutton">Envoyer le message</button>
        <!--</form>-->
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

        <script>
            jQuery(function ($) {
                $.datepicker.regional['fr'] = {
                    closeText: 'Fermer',
                    prevText: '&#x3c;Préc',
                    nextText: 'Suiv&#x3e;',
                    currentText: 'Aujourd\'hui',
                    monthNames: ['Janvier', 'Fevrier', 'Mars', 'Avril', 'Mai', 'Juin',
                        'Juillet', 'Aout', 'Septembre', 'Octobre', 'Novembre', 'Decembre'],
                    monthNamesShort: ['Jan', 'Fev', 'Mar', 'Avr', 'Mai', 'Jun',
                        'Jul', 'Aou', 'Sep', 'Oct', 'Nov', 'Dec'],
                    dayNames: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],
                    dayNamesShort: ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'],
                    dayNamesMin: ['Di', 'Lu', 'Ma', 'Me', 'Je', 'Ve', 'Sa'],
                    weekHeader: 'Sm',
                    dateFormat: 'dd-mm-yy',
                    firstDay: 1,
                    isRTL: false,
                    showMonthAfterYear: false,
                    yearSuffix: '',
                    minDate: '-0M -0D',
                    maxDate: '+12M +0D',
                    numberOfMonths: 1,
                    showButtonPanel: true
                };
                $.datepicker.setDefaults($.datepicker.regional['fr']);
            });
        </script>

        <script src="/socket.io/socket.io.js"></script>

        <script>
            /*
             * Action à associer à un chechbox.
             * Rend "enabled" ou "disabled" tous les éléments qui ont
             * une classe en commun avec le checkbox (sauf le checkbox lui-même)
             * selon qu'il soit coché ou non.
             */
            function toggle(event) {
                var cb = event.target;
                var ips = cb.classList;
                for (var e of document.getElementsByClassName(ips)) {
                    e.disabled = !cb.checked;
                }
                cb.disabled = false;
            }
            /*
             * Action à associer à un chechbox.
             * Rend "enabled" ou "disabled" tous les éléments qui ont
             * une classe en commun avec le checkbox (sauf le checkbox lui-même)
             * selon qu'il soit coché ou non.
             */
            function send(event) {
                var message = document.getElementById("newtodo").value.trim();
                var liste = [];
                for (var e of document.getElementsByClassName("message")) {
                    liste.push(JSON.parse(e.value))
                }

                if (message !== "") {
                    //var date = new Date(document.getElementById("datepicker").value);
                    var date = $("#datepicker").datepicker("getDate");
                    if (date !== null) {
                        date.setHours(23);
                        date.setMinutes(59);
                    }
                    console.log(date);
                    var hrd = {h: document.getElementById("hdebut").value, m: document.getElementById("mdebut").value};
                    var hrf = {h: document.getElementById("hfin").value, m: document.getElementById("mfin").value};
                    var cm = {date: date, debut: hrd, fin: hrf, message: message};

                    console.log(cm);
                    liste.push(cm);
                }
                socket.emit('change_list', liste); // Transmet la liste au serveur
                init();
                return false;
            }
        </script>
        <script>
            function one_msg(i, todo) {var classe;
                if (i % 2 === 0) {
                    classe = "pair";
                } else {
                    classe = "impair";
                }
                //return "<p class=\"liste " + classe + "\"><span class=\"cliquable\" onclick=\"up(" + i + ")\"> (↑) </span><span class=\"cliquable\" onclick=\"down(" + i + ")\"> (↓) </span><span class=\"cliquable\" onclick=\"sup(" + i + ")\"> (✘) </span><textarea class=\"message\" cols=\"120\" rows=\"1\">" + todo + "</textarea></p>";            
                return "<p class=\"liste " + classe + "\"><button class=\"cliquable\" onclick=\"sup(" + i + ")\"> ✘ </button><textarea class=\"message\" cols=\"120\" rows=\"1\">" + todo + "</textarea></p>";
            }
        </script>


        <script>
            function horloge(doc) {
                var mois = ["janvier", "février", "mars", "avril", "mai", "juin",
                    "juillet", "août", "septembre", "octobre", "novembre", "décembre"];

                var hm = doc.getElementById("div_horloge");
                var d = doc.getElementById("div_date");
                var date = new Date();
                var str = date.getHours();
                str += ':' + (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();
                str += ':' + (date.getSeconds() < 10 ? '0' : '') + date.getSeconds();

                hm.innerHTML = str;

                str = "";

                str += date.getDate() + " ";
                str += mois[date.getMonth()] + " ";
                str += date.getFullYear();

                d.innerHTML = str;

            }
        </script>
        <script>
            //window.onload = function () {
            horloge(document);
            setInterval(horloge, 1000, document);
            //};
        </script>
        <script>
            $(function () {
                $("#datepicker").datepicker();
            });
        </script>
        <script>
            
            var init = function () {
                $('#datepicker').datepicker();
                var date = new Date();document.getElementById("datepicker").value = "";
                date.getHours();

                document.getElementById("hdebut").selectedIndex = date.getHours();
                document.getElementById("mdebut").selectedIndex = 0;
                document.getElementById("hfin").selectedIndex = 23;
                document.getElementById("mfin").selectedIndex = 11;
                document.getElementById('newtodo').value = "";

                document.getElementById('iddate').checked = false;
                document.getElementById('iddebut').checked = false;
                document.getElementById('idfin').checked = false;
                document.getElementById('datepicker').disabled = true;
                document.getElementById('hdebut').disabled = true;
                document.getElementById('mdebut').disabled = true;
                document.getElementById('hfin').disabled = true;
                document.getElementById('mfin').disabled = true;

            };
            var initHandlers = function () {
                init();

                //document.getElementById("iddate").addEventListener("click", emptyingDate, false);
                document.getElementById("iddate").addEventListener("click", toggle, false);
                document.getElementById("iddebut").addEventListener("click", toggle, false);
                document.getElementById("idfin").addEventListener("click", toggle, false);

                document.getElementById("sendbutton").addEventListener("click", send, false);
            };
            //détache le gestionnaire de <body>
            var unloadHandlers = function () {
                //document.body.removeEventListener("click", onclickCounter, false);
                document.getElementById("iddate").removeEventListener("click", toggle, false);
                document.getElementById("iddebut").removeEventListener("click", toggle, false);
                document.getElementById("idfin").removeEventListener("click", toggle, false);
            };
            //chargement de la page
            window.addEventListener("load", initHandlers, false);
            //déchargement de la page
            window.addEventListener("unload", unloadHandlers, false);
        </script>
        <script>
            // Connexion à socket.io
            var socket = io.connect('http://192.168.1.56:8080');

            document.title = "Bonjour Maman";

            socket.emit('new', '');

            // Demande de mise à jour
            socket.on('update', function (data) {
                $('#zone_msg').empty();
                for (var i in data.todolist) {
                    $('#zone_msg').append(one_msg(i, JSON.stringify(data.todolist[i])));
                }
            });
            function sup(i) {
                socket.emit('sup_msg', i);
            }
            function up(i) {
                socket.emit('up_msg', i);
            }
            function down(i) {
                socket.emit('down_msg', i);
            }
        </script>
    </body>
</html>
